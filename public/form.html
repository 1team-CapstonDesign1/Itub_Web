<!DOCTYPE html>
<html>

<head>
    <title>email form</title>
</head>

<body>
    <form action="/email/form" method="post">
        email : <input type="text" name="email"><br/>
        <input type="submit"> <!-- action url로 다음 데이터들을 보아 날아감-->
    </form>

    <button class="ajaxsend">ajax_send</button>

    <div class='result'></div>

    <script>
        document.querySelector('.ajaxsend').addEventListener('click', function(){
            var inputdata = document.forms[0].elements[0].value 
            console.log(inputdata)
            // 배열로도 정의 가능
            sendAjax('/ajax', inputdata)
        });

        function sendAjax(url, data){
            var data = {'email': data};
            data = JSON.stringify(data); // json을 문자열 형태로 만들어줌
            console.log(data)
            var xhr = new XMLHttpRequest();
            xhr.open('POST', url);
            xhr.setRequestHeader('Content-Type', "application/json"); 
            // 서버로 보낼때 json 형태의 데이터를 보내기위해 지정
            xhr.send(data); // 문자열 형태로 넣어줘야함
            xhr.addEventListener('load', function(){
                var result = JSON.parse(xhr.responseText);
                var resultDiv = document.querySelector('.result');

                if(result.result !== 'ok') resultDiv.innerHTML = "not found"
                else resultDiv.innerHTML = result.name;
            });
        }
    </script>
</body>

</html>