<!DOCTYPE html>
<html lang='ko'>

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title> I-Tub </title>

    <link rel="stylesheet" href="registration_style.css">
</head>

<body>

    <form>
        <div class="reg_title">
            <h1>회원가입</h1>
        </div>

        <div class="contents">
            <div class="wrap">
                <h3 class="title"><label id='nickname'>별명</label></h3>
                <span class="inputtext">
                    <input type='text' class="texting" id='input_name' />
                </span>
            </div>

            <div class="wrap">
                <h3 class="title"><label for='gender'>성별</label></h3>
                <div class="gender_wrap">
                    <div class="item_inp item_radio">
                        <input type='radio' name='gender_radio' class="inp_g inp_radio" value='0' />
                        <label class="lab_g lab_radio" for="id_gender_18">
                            <span class="ico_account ico_radio"></span>
                            <span class="txt_radio">남성</span>
                        </label>
                    </div>

                    <div class="item_inp item_radio">
                        <input type='radio' name='gender_radio' class="inp_g inp_radio" value='1' />
                        <label class="lab_g lab_radio" for="id_gender_18">
                            <span class="ico_account ico_radio"></span>
                            <span class="txt_radio">여성</span>
                        </label>
                    </div>
                </div>
            </div>


            <div class="wrap">
                <h3 class="title"><label>나이</label></h3>
                <span class="inputtext">
                    <input type='number' class="texting" id='input_age' />
                </span>
            </div>
            <div class="wrap">
                <h3 class="title"><label>직업</label></h3>
                <span class="inputtext">
                    <input type='text' class="texting" id='input_job' />
                </span>
            </div>

            <div class="wrap">
                <div class="btn_wrap">
                    <div class="btn_div">
                        <button type='button' class="btn" onclick='location.href="./Profile.html"'>취소</button>
                    </div>
                    <div class="btn_div">
                        <button type='button' class='submit btn'>가입</button>
                    </div>
                </div>
            </div>
        </div>
    </form>

    <script>
        // document.querySelector('.refer').addEventListener('click', function() {
        //     var inputdata = document.getElementById('nick_input_find').value;
        //     console.log(inputdata)
        //     // 배열로도 정의 가능
        //     sendDB('/db/reference', inputdata);
        // });

        // document.querySelector('.del').addEventListener('click', function() {
        //     var inputdata = document.getElementById('nick_input_del').value;
        //     console.log(inputdata)
        //     // 배열로도 정의 가능
        //     sendDB('/db/delete', inputdata)
        // });

        document.querySelector('.submit').addEventListener('click', function() {
            alert('등록 완료');
            var inputdata = {};
            var radio_btn = document.getElementsByName('gender_radio');
            var radio_result;

            function getRadio() {
                for (var i = 0; i < radio_btn.length; i++) {
                    if (radio_btn[i].checked == true) return radio_btn[i].value;
                }
            };

            inputdata = {
                'u_name': document.getElementById('input_name').value,
                'u_gender': getRadio(),
                'u_age': document.getElementById('input_age').value,
                'u_job': document.getElementById('input_job').value
            }

            console.log(inputdata)
            // 배열로도 정의 가능
            sendDB('/db/create', inputdata)
            location.href = './Profile.html'
        });

        function sendDB(url, data) {
            var data = {
                'data': data
            };
            console.log(data + '데이터형 변경 전');
            data = JSON.stringify(data); // json을 문자열 형태로 만들어줌
            console.log(data + '데이터형 변경 후')
            var xhr = new XMLHttpRequest();
            xhr.open('POST', url);
            xhr.setRequestHeader('Content-Type', 'application/json');
            // 서버로 보낼때 json 형태의 데이터를 보내기위해 지정
            xhr.send(data); // 문자열 형태로 넣어줘야함
            console.log(data + 'xhr send')

            xhr.addEventListener('load', function() {
                var result = JSON.parse(xhr.responseText);
                var resultDiv;

                console.log('데이터 넘겨받음' + result.result)
                if (result.result == 'ok' && result.type == 'create') {
                    resultDiv = document.querySelector('.create');
                    resultDiv.innerHTML = '가입테스트 : ' + '가입이 완료되었습니다.'
                }  else if (result.result == 'none' && result.type == 'create') {
                    resultDiv = document.querySelector('.create');
                    resultDiv.innerHTML = '되겠냐?';
                }
            });
        }
    </script>
</body>

</html>