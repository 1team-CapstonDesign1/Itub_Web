<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title> I-Tub </title>
</head>

<body>
    <h1>회원가입</h1>
    <form>
        <div>
            <div>
                <label id='nickname'>별명:</label>
                <input type="text" id="name" />
            </div>
            <div>
                <label for="gender">성별:</label>
                <input type="radio" id="gender" name="gender" value="남" /> <span class="up"> 남성 </span>
                <input type="radio" id="gender" name="gender" value="여" /> <span class="up"> 여성 </span>
            </div>
            <div>
                <label>나이:</label>
                <input type="number" id="age" />
            </div>
            <div>
                <label>자기소개:</label> <textarea id="msg"></textarea>
            </div>
            <button type="button" onclick='alert("연결중")'>취소</button>
            <button type="button" onclick='alert("등록완료")'>가입</button>
        </div>

        <p>&nbsp</p>

        <div>
            <label class="nickname">별명: </label>
            <input type="text" id="nick_input_find"/>
            <button type='button' class="refer">조회</button>
            <div class="find">조회테스트 : </div>
        </div>

        <p>&nbsp</p>

        <div>
            <label class="nickname">지울별명: </label>
            <input type="text" id="nick_input_del"/>
            <button type="button" class="del">삭제</button>
            <div class="dele">삭제테스트 : </div>
        </div>
    </form>

    <script>
        var func_select = document.querySelector('.refer').addEventListener('click', function(){
            var inputdata = document.getElementById('nick_input_find');
            console.log(inputdata)
            // 배열로도 정의 가능
            sendAjax('/db/reference', inputdata.value);
        });

        document.querySelector('.del').addEventListener('click', function(){
            var inputdata = document.getElementById('nick_input_del');
            console.log(inputdata)
            // 배열로도 정의 가능
            sendAjax('/db/delete', inputdata.value)
        });

        function sendAjax(url, data){
            var data = {'data': data};
            data = JSON.stringify(data); // json을 문자열 형태로 만들어줌
            console.log(data)
            var xhr = new XMLHttpRequest();
            xhr.open('POST', url);
            xhr.setRequestHeader('Content-Type', "application/json"); 
            // 서버로 보낼때 json 형태의 데이터를 보내기위해 지정
            xhr.send(data); // 문자열 형태로 넣어줘야함

            xhr.addEventListener('load', function(){
                var result = JSON.parse(xhr.responseText);
                var resultDiv;

                console.log('데이터 넘겨받음' + result.result + ' ' + result.data)
                if(result.result == 'ok' && result.type == 'reference') {
                    resultDiv = document.querySelector('.find');
                    resultDiv.innerHTML = '조회테스트 : ' + '\n고유번호 : ' + result.u_num + ', 나이 : ' + result.age + ', 성별 : ' + result.gender + ', 직업 : ' + result.job;
                } else if(result.result == 'ok' && result.type == 'delete') {
                    resultDiv = document.querySelector('.dele');
                    resultDiv.innerHTML = '삭제테스트 : ' + '\n삭제가 완료되었습니다.'
                } else if (result.result = 'none') resultDiv.innerHTML = '되겠냐?';
            });
        }
    </script>
</body>

</html>