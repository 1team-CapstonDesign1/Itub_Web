<!DOCTYPE html>
<html lang='ko'>

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title> I-Tub </title>
</head>

<body>
    <h1>회원가입</h1>
    <form>
        <div>
            <div>
                <label id='nickname'>별명:</label>
                <input type='text' id='input_name' />
            </div>
            <div>
                <label for='gender'>성별:</label>
                <input type='radio' name='gender_radio' value='0' /> <span class='up'> 남성 </span>
                <input type='radio' name='gender_radio' value='1' /> <span class='up'> 여성 </span>
            </div>
            <div>
                <label>나이:</label>
                <input type='number' id='input_age' />
            </div>
            <div>
                <label>직업:</label>
                <input type='text' id='input_job' />
            </div>

            <p></p>
            <div>
                <button type='button' onclick='alert("원래 창으로 돌아가는 기능 추가 예정")'>취소</button>
                <button type='button' class='submit'>가입</button>
                <div class='create'>가입테스트 : </div>
            </div>
        </div>

        <p>&nbsp</p>

        <div>
            <label class='nickname'>별명: </label>
            <input type='text' id='nick_input_find' />
            <button type='button' class='refer'>조회</button>
            <div class='find'>조회테스트 : </div>
        </div>

        <p>&nbsp</p>

        <div>
            <label class='nickname'>지울별명: </label>
            <input type='text' id='nick_input_del' />
            <button type='button' class='del'>삭제</button>
            <div class='dele'>삭제테스트 : </div>
        </div>
    </form>

    <script>
        document.querySelector('.refer').addEventListener('click', function () {
            var inputdata = document.getElementById('nick_input_find').value;
            console.log(inputdata)
            // 배열로도 정의 가능
            sendDB('/db/reference', inputdata);
        });

        document.querySelector('.del').addEventListener('click', function () {
            var inputdata = document.getElementById('nick_input_del').value;
            console.log(inputdata)
            // 배열로도 정의 가능
            sendDB('/db/delete', inputdata)
        });

        document.querySelector('.submit').addEventListener('click', function () {
            alert('등록 완료');
            var inputdata = {};
            var radio_btn = document.getElementsByName('gender_radio');
            var radio_result;

            function getRadio() {
                    for (var i = 0; i < radio_btn.length; i++){
                        if (radio_btn[i].checked == true) return radio_btn[i].value;
                    }
            };

            inputdata = {
                'u_name': document.getElementById('input_name').value,
                'u_gender': parseInt(getRadio()),
                'u_age': document.parseInt(getElementById('input_age').value),
                'u_job': document.getElementById('input_job').value
            }

            console.log(inputdata)
            // 배열로도 정의 가능
            sendDB('/db/create', inputdata)
        });

        function sendDB(url, data) {
            var data = { 'data': data };
            console.log(data + '데이터형 변경 전');
            data = JSON.stringify(data); // json을 문자열 형태로 만들어줌
            console.log(data + '데이터형 변경 후')
            var xhr = new XMLHttpRequest();
            xhr.open('POST', url);
            xhr.setRequestHeader('Content-Type', 'application/json');
            // 서버로 보낼때 json 형태의 데이터를 보내기위해 지정
            xhr.send(data); // 문자열 형태로 넣어줘야함
            console.log(data + 'xhr send')

            xhr.addEventListener('load', function () {
                var result = JSON.parse(xhr.responseText);
                var resultDiv;

                console.log('데이터 넘겨받음' + result.result)
                if (result.result == 'ok' && result.type == 'reference') {
                    resultDiv = document.querySelector('.find');
                    resultDiv.innerHTML = '조회테스트 : ' + '고유번호 : ' + result.u_num + ', 나이 : ' + result.age + ', 성별 : ' + result.gender + ', 직업 : ' + result.job;
                } else if (result.result == 'ok' && result.type == 'delete') {
                    resultDiv = document.querySelector('.dele');
                    resultDiv.innerHTML = '삭제테스트 : ' + '삭제가 완료되었습니다.'
                } else if (result.result == 'ok' && result.type == 'create') {
                    resultDiv = document.querySelector('.create');
                    resultDiv.innerHTML = '가입테스트 : ' + '가입이 완료되었습니다.'
                } else if (result.result == 'none' && result.type == 'reference') {
                    resultDiv = document.querySelector('.find');
                    resultDiv.innerHTML = '되겠냐?';
                } else if (result.result == 'none' && result.type == 'delete') {
                    resultDiv = document.querySelector('.dele');
                    resultDiv.innerHTML = '되겠냐?';
                } else if (result.result == 'none' && result.type == 'create') {
                    resultDiv = document.querySelector('.create');
                    resultDiv.innerHTML = '되겠냐?';
                }
            });
        }
    </script>
</body>

</html>